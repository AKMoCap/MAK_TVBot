{% extends "base.html" %}

{% block title %}Dashboard - MAK Trading Bot{% endblock %}

{% block content %}
<div class="row g-4">
    <!-- Account Overview Cards -->
    <div class="col-12">
        <div class="row g-3">
            <!-- Account Value -->
            <div class="col-md-3">
                <div class="card bg-darker border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Account Value</h6>
                                <h3 class="mb-0" id="account-value">$0.00</h3>
                            </div>
                            <div class="bg-primary bg-opacity-25 p-3 rounded">
                                <i class="bi bi-wallet2 text-primary fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total P&L Today -->
            <div class="col-md-3">
                <div class="card bg-darker border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Today's P&L</h6>
                                <h3 class="mb-0" id="daily-pnl">$0.00</h3>
                            </div>
                            <div class="bg-success bg-opacity-25 p-3 rounded" id="pnl-icon-container">
                                <i class="bi bi-graph-up text-success fs-4" id="pnl-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Open Positions -->
            <div class="col-md-3">
                <div class="card bg-darker border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Open Positions</h6>
                                <h3 class="mb-0" id="open-positions">0</h3>
                            </div>
                            <div class="bg-info bg-opacity-25 p-3 rounded">
                                <i class="bi bi-layers text-info fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trades Today -->
            <div class="col-md-3">
                <div class="card bg-darker border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Trades Today</h6>
                                <h3 class="mb-0" id="trades-today">0</h3>
                            </div>
                            <div class="bg-warning bg-opacity-25 p-3 rounded">
                                <i class="bi bi-arrow-left-right text-warning fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="col-lg-8">
        <!-- Open Positions Table -->
        <div class="card bg-darker border-secondary mb-4">
            <div class="card-header bg-transparent border-secondary d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Open Positions</h5>
                <button class="btn btn-outline-danger btn-sm" id="close-all-btn">
                    <i class="bi bi-x-circle me-1"></i>Close All
                </button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Coin</th>
                                <th>Side</th>
                                <th>Size</th>
                                <th>Entry</th>
                                <th>Mark</th>
                                <th>Liq. Price</th>
                                <th>P&L</th>
                                <th>Leverage</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="positions-table">
                            <tr>
                                <td colspan="9" class="text-center text-muted py-4">
                                    <i class="bi bi-inbox fs-3 d-block mb-2"></i>
                                    No open positions
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card bg-darker border-secondary">
            <div class="card-header bg-transparent border-secondary">
                <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Activity</h5>
            </div>
            <div class="card-body p-0">
                <div class="activity-list" id="activity-list" style="max-height: 300px; overflow-y: auto;">
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-inbox fs-3 d-block mb-2"></i>
                        No recent activity
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Sidebar -->
    <div class="col-lg-4">
        <!-- Quick Trade Panel -->
        <div class="card bg-darker border-secondary mb-4">
            <div class="card-header bg-transparent border-secondary">
                <h5 class="mb-0"><i class="bi bi-lightning me-2"></i>Quick Trade</h5>
            </div>
            <div class="card-body">
                <form id="quick-trade-form">
                    <div class="mb-3">
                        <label class="form-label">Coin</label>
                        <select class="form-select bg-dark text-light border-secondary" id="trade-coin">
                            <optgroup label="MAJORS">
                                <option value="BTC">BTC</option>
                                <option value="ETH">ETH</option>
                                <option value="SOL">SOL</option>
                                <option value="HYPE">HYPE</option>
                            </optgroup>
                            <optgroup label="DEFI">
                                <option value="AAVE">AAVE</option>
                                <option value="ENA">ENA</option>
                                <option value="PENDLE">PENDLE</option>
                                <option value="VIRTUAL">VIRTUAL</option>
                                <option value="AERO">AERO</option>
                            </optgroup>
                            <optgroup label="HIGH BETA / MEMES">
                                <option value="DOGE">DOGE</option>
                                <option value="PUMP">PUMP</option>
                                <option value="FARTCOIN">FARTCOIN</option>
                                <option value="kBONK">kBONK</option>
                                <option value="kPEPE">kPEPE</option>
                                <option value="PENGU">PENGU</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Collateral (USD)</label>
                        <input type="number" class="form-control bg-dark text-light border-secondary"
                               id="trade-collateral" value="100" min="1" step="1">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Leverage</label>
                        <div class="input-group">
                            <input type="range" class="form-range" id="trade-leverage-range"
                                   min="1" max="20" value="10">
                            <span class="ms-3 badge bg-primary" id="leverage-display">10x</span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label">Stop Loss %</label>
                            <input type="number" class="form-control bg-dark text-light border-secondary"
                                   id="trade-sl" placeholder="e.g., 2" step="0.1">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Take Profit %</label>
                            <input type="number" class="form-control bg-dark text-light border-secondary"
                                   id="trade-tp" placeholder="e.g., 5" step="0.1">
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-success" id="buy-btn">
                            <i class="bi bi-arrow-up-circle me-1"></i>Long / Buy
                        </button>
                        <button type="button" class="btn btn-danger" id="sell-btn">
                            <i class="bi bi-arrow-down-circle me-1"></i>Short / Sell
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Risk Status -->
        <div class="card bg-darker border-secondary">
            <div class="card-header bg-transparent border-secondary">
                <h5 class="mb-0"><i class="bi bi-shield-check me-2"></i>Risk Status</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Collateral at Risk</span>
                        <span id="collateral-risk-status">0% / 75%</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-info" role="progressbar" style="width: 0%"
                             id="collateral-risk-bar"></div>
                    </div>
                    <small class="text-muted">% of account USDC used as collateral</small>
                </div>

                <div class="mb-0">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Cross Margin Used</span>
                        <span id="cross-margin-status">0x / 10x</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 0%"
                             id="cross-margin-bar"></div>
                    </div>
                    <small class="text-muted">Effective leverage vs max allowed</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Close Position Modal -->
<div class="modal fade" id="closePositionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Close Position</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to close the <strong id="close-position-coin"></strong> position?</p>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-close-btn">Close Position</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize dashboard
    initDashboard();

    // Refresh data every 5 seconds
    setInterval(refreshDashboard, 5000);
});
</script>
{% endblock %}
